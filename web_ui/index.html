<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Sick Day Helper</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <div id="app">
    <nav id="sidebar">
      <div class="sidebar-title">Sick Day Helper</div>
      <ul class="nav-list">
        <li class="nav-item active" data-page="sick-day">
          <span class="nav-icon">&#9679;</span> Sick Day
        </li>
        <li class="nav-item" data-page="mapping">
          <span class="nav-icon">&#9679;</span> Mapping
        </li>
        <li class="nav-item" data-page="setup">
          <span class="nav-icon">&#9679;</span> Setup
        </li>
      </ul>
    </nav>

    <main id="content">
      <!-- Page: Sick Day -->
      <section id="page-sick-day" class="page">
        <h2>Sick Day</h2>

        <div id="sick-day-loading" class="loading">
          <div class="loading-spinner"></div>
          <p>Loading...</p>
        </div>

        <div id="sick-day-content" class="hidden">
          <!-- Active Sick Days -->
          <div id="active-sick-days">
            <h3>Active Sick Days</h3>
            <div id="active-list"></div>
          </div>

          <!-- Declare Sick Day -->
          <div id="declare-section">
            <h3>Declare Sick Day</h3>
            <div id="no-mapping-msg" class="info-box hidden">
              No person-to-automation mapping found. Go to <a href="#" onclick="App.navigateTo('setup'); return false;">Setup</a> to configure.
            </div>
            <div id="declare-form" class="form-card">
              <div class="form-group">
                <label for="declare-person">Person</label>
                <select id="declare-person"></select>
              </div>
              <div class="form-group">
                <label>Duration</label>
                <div class="toggle-group">
                  <button class="toggle-btn active" data-type="days" onclick="App.setDurationType('days')">Number of Days</button>
                  <button class="toggle-btn" data-type="date" onclick="App.setDurationType('date')">Until Date</button>
                </div>
              </div>
              <div id="duration-days-group" class="form-group">
                <label for="declare-days">Days: <span id="days-display">1</span></label>
                <input type="range" id="declare-days" min="1" max="14" value="1" oninput="document.getElementById('days-display').textContent=this.value">
              </div>
              <div id="duration-date-group" class="form-group hidden">
                <label for="declare-date">End Date</label>
                <input type="date" id="declare-date">
              </div>
              <div class="btn-row">
                <button class="btn btn-primary" id="declare-submit" onclick="App.declareSickDay()">Submit</button>
              </div>
            </div>
          </div>
        </div>
      </section>

      <!-- Page: Mapping -->
      <section id="page-mapping" class="page hidden">
        <h2>Mapping</h2>
        <div id="mapping-loading" class="loading">
          <div class="loading-spinner"></div>
          <p>Loading mapping...</p>
        </div>
        <div id="mapping-content" class="hidden">
          <div id="mapping-list"></div>
          <div class="btn-row" style="margin-top: 24px;">
            <button class="btn btn-secondary" onclick="App.navigateTo('setup')">Edit Mapping</button>
          </div>
        </div>
      </section>

      <!-- Page: Setup (Wizard) -->
      <section id="page-setup" class="page hidden">
        <div id="progress-bar">
          <div class="step" data-step="1"><span class="num">1</span> Welcome</div>
          <div class="step" data-step="2"><span class="num">2</span> People</div>
          <div class="step" data-step="3"><span class="num">3</span> Areas</div>
          <div class="step" data-step="4"><span class="num">4</span> Review</div>
          <div class="step" data-step="5"><span class="num">5</span> Done</div>
        </div>

        <div id="wizard-content">
          <!-- Step 1: Welcome -->
          <section id="step-1" class="step-panel">
            <h2>Welcome</h2>
            <div id="welcome-loading" class="loading">
              <div class="loading-spinner"></div>
              <p>Discovering people, areas, and automations...</p>
              <div class="loading-bar"><div class="loading-bar-fill"></div></div>
            </div>
            <div id="welcome-content" class="hidden">
              <div class="stats-grid">
                <div class="stat-card">
                  <div class="stat-num" id="stat-people">0</div>
                  <div class="stat-label">People</div>
                </div>
                <div class="stat-card">
                  <div class="stat-num" id="stat-areas">0</div>
                  <div class="stat-label">Areas</div>
                </div>
                <div class="stat-card">
                  <div class="stat-num" id="stat-automations">0</div>
                  <div class="stat-label">Automations</div>
                </div>
                <div class="stat-card">
                  <div class="stat-num" id="stat-time">0</div>
                  <div class="stat-label">Time-triggered</div>
                </div>
                <div class="stat-card">
                  <div class="stat-num" id="stat-day">0</div>
                  <div class="stat-label">Day-filtered</div>
                </div>
              </div>
              <div id="welcome-existing" class="hidden">
                <p class="info-box">Setup has already been completed. You can view your current mapping or re-run the wizard.</p>
                <div class="btn-row">
                  <button class="btn btn-primary" onclick="Wizard.startWizard()">Re-run Wizard</button>
                </div>
              </div>
              <div id="welcome-new">
                <p>The wizard will help you map people to automations that should be disabled on sick days.</p>
                <div class="btn-row">
                  <button class="btn btn-primary" onclick="Wizard.startWizard()">Start Setup Wizard</button>
                  <button class="btn btn-secondary" onclick="Wizard.skipToAutoMapping()">Skip (use auto-mapping)</button>
                </div>
              </div>
            </div>
          </section>

          <!-- Step 2: People -->
          <section id="step-2" class="step-panel hidden">
            <h2>Select People</h2>
            <p>Choose which people should be available for sick days.</p>
            <div id="people-list" class="checkbox-list"></div>
            <p class="create-link">Don't see someone? <a href="/config/person" target="_blank">Create a new person</a> in Settings &gt; People, then re-run the wizard.</p>
            <div class="btn-row">
              <button class="btn btn-secondary" onclick="Wizard.goToStep(1)">Back</button>
              <button class="btn btn-primary" onclick="Wizard.submitPeople()">Next</button>
            </div>
          </section>

          <!-- Step 3: Areas -->
          <section id="step-3" class="step-panel hidden">
            <h2>Assign Areas to People</h2>
            <p>Assign each area's automations to one or more people. You can fine-tune individual automations in the next step.</p>
            <div id="areas-list"></div>
            <div id="unassigned-section" class="hidden">
              <h3>Unassigned Automations</h3>
              <p class="subtext">These automations are not in any HA area.</p>
              <div id="unassigned-list"></div>
            </div>
            <div class="btn-row">
              <button class="btn btn-secondary" onclick="Wizard.goToStep(2)">Back</button>
              <button class="btn btn-primary" onclick="Wizard.submitAreas()">Next</button>
            </div>
          </section>

          <!-- Step 4: Review -->
          <section id="step-4" class="step-panel hidden">
            <h2>Review Mapping</h2>
            <p>Review and fine-tune the automation mapping for each person.</p>
            <div id="review-list"></div>
            <div id="add-automation-row" class="hidden">
              <h3>Add Unmapped Automation</h3>
              <div class="inline-form">
                <select id="add-auto-person"></select>
                <select id="add-auto-automation"></select>
                <button class="btn btn-small" onclick="Wizard.addAutomation()">Add</button>
              </div>
            </div>
            <div class="btn-row">
              <button class="btn btn-secondary" onclick="Wizard.goToStep(3)">Back</button>
              <button class="btn btn-primary" onclick="Wizard.submitReview()">Save Mapping</button>
            </div>
          </section>

          <!-- Step 5: Complete -->
          <section id="step-5" class="step-panel hidden">
            <h2>Setup Complete</h2>
            <div id="complete-summary"></div>
            <div class="btn-row">
              <button class="btn btn-secondary" onclick="Wizard.resetWizard()">Re-run Wizard</button>
            </div>
          </section>
        </div>
      </section>
    </main>
  </div>
  <script src="wizard.js"></script>
</body>
</html>
